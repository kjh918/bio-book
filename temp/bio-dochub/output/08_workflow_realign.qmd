# Realign

## gatk3 (v3.8)

> GATK 3.8 Indel Realignment (Modular Version)<br>1. RealignerTargetCreator: 리얼라인먼트가 필요한 타겟 구간 선정<br>2. IndelRealigner: 선정된 구간에 대해 로컬 재정렬 수행<br>- Modular Suffix 구조로 설계되어 다양한 전단계 BAM 수용 가능

### Execution Script
실제 분석을 구동하기 위해 사용자가 실행하는 래퍼(Wrapper) 스크립트입니다.

```bash
python /storage/home/jhkim/scripts/bioscript/pipeline/cbNIPT/v3.0.0/scripts/run_gatk4_dedup_using_singularity.py [arguments...]
```

### Local Command (Internal)
스크립트 내부에서 설정값을 조합하여 실행되는 명령어입니다.

```bash
[singularity_bin] exec -B [bind] [sif] [java_bin] -Xmx[xmx_mb]m -jar [gatk_jar] \
  -T RealignerTargetCreator -R [ReferenceFasta] -I \
  [BamDir]/[SeqID].[InputSuffix].bam -o [target_intervals] -known [KnownIndel1] \
  -known [KnownIndel2] -nt [Threads] && [singularity_bin] exec -B [bind] [sif] \
  [java_bin] -Xmx[xmx_mb]m -jar [gatk_jar] -T IndelRealigner -R [ReferenceFasta] \
  -targetIntervals [target_intervals] -known [KnownIndel1] -known [KnownIndel2] -I \
  [BamDir]/[SeqID].[InputSuffix].bam -o [realigned_bam]
```

### Parameters & I/O

::: {style="font-size: 0.85em;"}

#### Inputs
| Argument | Required | Description |
|:---|:---|:---|
| `SeqID` | ✅ | Sequence identifier used for file naming |
| `BamDir` | ✅ | Directory containing the input BAM and target output BAM |
| `qcResDir` | ✅ | Directory for the target intervals file output |
| `ReferenceFasta` | ✅ | Path to the reference genome FASTA file |
| `KnownIndel1` | ✅ | Path to known Indels VCF (e.g., Mills and 1000G) |
| `KnownIndel2` | ✅ | Path to additional known Indels VCF |

: {tbl-colwidths="[20, 12, 28, 40]"}

#### Outputs
| Argument | Default | Description |
|:---|:---|:---|
| `target_intervals` | [qcResDir]/[SeqID].[OutputSuffix].realign_target.intervals | Target intervals file identifying regions for realignment |
| `realigned_bam` | [BamDir]/[SeqID].[OutputSuffix].bam | Final Indel-realigned BAM file |

: {tbl-colwidths="[20, 12, 28, 40]"}

#### Parameters
| Argument | Default | Description |
|:---|:---|:---|
| `InputSuffix` | dedup | Suffix of input BAM (e.g., dedup, sorted, primary) |
| `OutputSuffix` | realign | Suffix for output BAM (e.g., realign, ir) |
| `singularity_bin` | singularity | Path to singularity executable |
| `java_bin` | java | Java executable (inside container) |
| `gatk_jar` | /usr/GenomeAnalysisTK.jar | GATK 3.8 jar path inside container |
| `sif` | /storage/images/gatk-3.8-1.sif | GATK 3.8 singularity image file |
| `bind` | /storage,/data | Mount paths for singularity |
| `Threads` | 8 | Number of threads for RealignerTargetCreator (-nt) |
| `xmx_mb` | 16384 | Maximum Java heap memory (MB) |

: {tbl-colwidths="[20, 12, 28, 40]"}

:::

***

